<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>게임 화면 (대기)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif; }
    body { margin:0; background:#0f172a; color:#fff; display:grid; place-items:center; min-height:100vh; }
    .card { background:#111827; border:1px solid #374151; border-radius:16px; padding:24px; width:92%; max-width:420px; text-align:center; }
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; background:#0b1220;border:1px solid #334155;padding:4px 6px;border-radius:8px}
  </style>
</head>
<body>
  <div class="card">
    <div id="status">게임 연결 확인 중...</div>
    <div style="margin-top:10px;">게임 ID: <span id="gid" class="kbd"></span></div>
  </div>

  <!-- Firebase CDN (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="./js/firebase-init.js"></script>
  <script>
    function getQuery(key){
      const u = new URL(location.href);
      return u.searchParams.get(key);
    }
    const gameId = getQuery('game') || localStorage.getItem('q_gameId') || '';
    document.getElementById('gid').textContent = gameId || '(없음)';

    auth.onAuthStateChanged(async (user) => {
      if (!user) { try { await auth.signInAnonymously(); } catch(e){} }
      if (!gameId) {
        document.getElementById('status').textContent = '게임 ID 없음: join 화면으로 돌아가세요.';
        return;
      }
      // 게임 상태 리스닝
      db.collection('q_games').doc(gameId).onSnapshot((snap)=>{
        if (!snap.exists) {
          document.getElementById('status').textContent = '게임을 찾을 수 없습니다. 게임 ID를 확인하세요.';
          return;
        }
        const g = snap.data();
        if (g.status === 'waiting') {
          document.getElementById('status').textContent = '대기 중... (교사가 시작하면 문제 화면으로 전환됩니다)';
        } else if (g.status === 'running') {
          document.getElementById('status').textContent = '진행 중... (다음 단계에서 문제 표시가 붙습니다)';
        } else if (g.status === 'ended') {
          document.getElementById('status').textContent = '게임이 종료되었습니다.';
        } else {
          document.getElementById('status').textContent = '상태: ' + g.status;
        }
      }, (err)=> {
        document.getElementById('status').textContent = '접속 오류: ' + err.message;
      });
    });
  </script>
</body>
</html>
